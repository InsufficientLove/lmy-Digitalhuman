# ğŸš€ MuseTalkæè‡´ä¼˜åŒ–ç‰ˆä½¿ç”¨æŒ‡å—

åŸºäº[MuseTalkå®˜æ–¹GitHub](https://github.com/TMElyralab/MuseTalk)æºç çš„æè‡´æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆã€‚

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆç‰¹ç‚¹

### âœ… é’ˆå¯¹æ‚¨çš„éœ€æ±‚ä¼˜åŒ–

1. **å›ºå®š5-6ä¸ªæ¨¡æ¿**: é¢„å¤„ç†ä¸€æ¬¡ï¼Œæ°¸ä¹…ä½¿ç”¨
2. **æ¨¡æ¿å·¥ä½œæµ**: é€‰æ‹©æ¨¡æ¿ â†’ ç”Ÿæˆæ¬¢è¿è§†é¢‘ â†’ æŒç»­å¯¹è¯
3. **4x RTX 4090æè‡´æ€§èƒ½**: çœŸæ­£çš„å¹¶è¡Œæ¨ç†
4. **å»é™¤å†—ä½™æ“ä½œ**: ä¸“æ³¨æ€§èƒ½ï¼Œç®€åŒ–é€»è¾‘

### ğŸ“Š æ€§èƒ½é¢„æœŸ

åŸºäº[å®˜æ–¹åŸºå‡†](https://github.com/TMElyralab/MuseTalk)ï¼š
- **RTX 3050 Ti**: 8ç§’è§†é¢‘ = 5åˆ†é’Ÿ
- **å•RTX 4090**: 8ç§’è§†é¢‘ = 50ç§’ (6å€æå‡)
- **4x RTX 4090å¹¶è¡Œ**: 8ç§’è§†é¢‘ = **12-15ç§’** (20å€æå‡)
- **æ‚¨çš„3ç§’è§†é¢‘**: é¢„æœŸ **3-5ç§’** å®Œæˆ

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### 1. å¤åˆ¶Pythonä¼˜åŒ–è„šæœ¬

å°† `optimized_musetalk_inference.py` å¤åˆ¶åˆ°æ‚¨çš„MuseTalkç›®å½•ï¼š

```bash
# å¤åˆ¶ä¼˜åŒ–è„šæœ¬
cp optimized_musetalk_inference.py C:\Users\Administrator\Desktop\digitalhuman\lmy-Digitalhuman\MuseTalk\
```

### 2. å‡†å¤‡æ¨¡æ¿ç›®å½•

ç¡®ä¿æ‚¨çš„æ¨¡æ¿åœ¨æ­£ç¡®ä½ç½®ï¼š

```
C:\Users\Administrator\Desktop\digitalhuman\lmy-Digitalhuman\LmyDigitalHuman\wwwroot\templates\
â”œâ”€â”€ Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7.jpg
â”œâ”€â”€ template2.jpg
â”œâ”€â”€ template3.jpg
â”œâ”€â”€ template4.jpg
â”œâ”€â”€ template5.jpg
â””â”€â”€ template6.jpg
```

### 3. ç¼–è¯‘å¹¶å¯åŠ¨æœåŠ¡

```bash
# ç¼–è¯‘é¡¹ç›®
dotnet build

# å¯åŠ¨æœåŠ¡
dotnet run
```

### 4. é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨é¢„å¤„ç†

æœåŠ¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶
2. é¢„å¤„ç†æ¯ä¸ªæ¨¡æ¿ï¼ˆé¢éƒ¨æ£€æµ‹ã€VAEç¼–ç ã€maskç”Ÿæˆï¼‰
3. ä¿å­˜é¢„å¤„ç†ç¼“å­˜åˆ°ç£ç›˜
4. åˆå§‹åŒ–4ä¸ªGPUçš„æ¨¡å‹å®ä¾‹

## ğŸ® å·¥ä½œæµç¨‹

### ğŸ“‹ æ¨¡æ¿é¢„å¤„ç†ï¼ˆä»…é¦–æ¬¡ï¼‰

```
å¯åŠ¨æœåŠ¡ â†’ è‡ªåŠ¨æ‰«ææ¨¡æ¿ â†’ å¹¶è¡Œé¢„å¤„ç† â†’ ç¼“å­˜åˆ°ç£ç›˜
é¢„æœŸæ—¶é—´ï¼šæ¯ä¸ªæ¨¡æ¿30-60ç§’ï¼ˆä»…é¦–æ¬¡ï¼‰
```

### âš¡ å®é™…æ¨ç†ï¼ˆæ¯æ¬¡è¯·æ±‚ï¼‰

```
ç”¨æˆ·è¯·æ±‚ â†’ åŠ è½½é¢„å¤„ç†ç¼“å­˜ â†’ 4GPUå¹¶è¡Œæ¨ç† â†’ ç”Ÿæˆè§†é¢‘
é¢„æœŸæ—¶é—´ï¼š3ç§’è§†é¢‘ = 3-5ç§’å®Œæˆ
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹æ€§èƒ½ç»Ÿè®¡

è®¿é—® `/api/musetalk/stats` æŸ¥çœ‹ï¼š

```json
{
  "totalRequests": 150,
  "completedRequests": 148,
  "completionRate": "98.67%",
  "pythonEngineStatus": "å·²åˆå§‹åŒ–",
  "templateUsage": {
    "Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7": 45,
    "template2": 32,
    "template3": 28,
    "template4": 25,
    "template5": 18,
    "template6": 12
  }
}
```

### GPUåˆ©ç”¨ç‡ç›‘æ§

```bash
# å®æ—¶ç›‘æ§GPUä½¿ç”¨æƒ…å†µ
nvidia-smi -l 1
```

é¢„æœŸçœ‹åˆ°4ä¸ªGPUéƒ½åœ¨å·¥ä½œï¼š

```
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 525.xx.xx    Driver Version: 525.xx.xx    CUDA Version: 12.0  |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  RTX 4090           Off  | 00000000:01:00.0  On |                  Off |
| 30%   65C    P2   350W / 450W |  20000MiB / 24564MiB |     95%      Default |
|   1  RTX 4090           Off  | 00000000:02:00.0 Off |                  Off |
| 30%   63C    P2   340W / 450W |  18000MiB / 24564MiB |     92%      Default |
|   2  RTX 4090           Off  | 00000000:03:00.0 Off |                  Off |
| 30%   61C    P2   335W / 450W |  17500MiB / 24564MiB |     89%      Default |
|   3  RTX 4090           Off  | 00000000:04:00.0 Off |                  Off |
| 30%   59C    P2   330W / 450W |  17000MiB / 24564MiB |     87%      Default |
+-----------------------------------------------------------------------------+
```

## ğŸ”§ é…ç½®è°ƒä¼˜

### æ‰¹å¤„ç†å¤§å°è°ƒæ•´

æ ¹æ®æ˜¾å­˜ä½¿ç”¨æƒ…å†µè°ƒæ•´ï¼š

```python
# åœ¨ optimized_musetalk_inference.py ä¸­
parser.add_argument("--batch_size", type=int, default=32)  # é»˜è®¤32

# å¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œå¯ä»¥å‡å°‘åˆ°16æˆ–8
# å¦‚æœæ˜¾å­˜å……è¶³ï¼Œå¯ä»¥å¢åŠ åˆ°64
```

### æ¨¡æ¿ç¼“å­˜ç®¡ç†

é¢„å¤„ç†ç¼“å­˜ä½ç½®ï¼š

```
C:\Users\Administrator\Desktop\digitalhuman\lmy-Digitalhuman\MuseTalk\results\optimized_templates\
â”œâ”€â”€ Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7\
â”‚   â””â”€â”€ preprocessed_cache.pkl
â”œâ”€â”€ template2\
â”‚   â””â”€â”€ preprocessed_cache.pkl
â””â”€â”€ ...
```

å¦‚éœ€é‡æ–°é¢„å¤„ç†ï¼Œåˆ é™¤å¯¹åº”çš„ `preprocessed_cache.pkl` æ–‡ä»¶ã€‚

## ğŸ‰ é¢„æœŸæ•ˆæœ

### âœ… é¦–æ¬¡å¯åŠ¨

```
ğŸš€ ä¼˜åŒ–ç‰ˆMuseTalkæœåŠ¡å·²å¯åŠ¨
ğŸ”§ å¼€å§‹åˆå§‹åŒ–Pythonæ¨ç†å™¨...
ğŸ® åˆå§‹åŒ–GPU 0 æ¨¡å‹...
ğŸ® åˆå§‹åŒ–GPU 1 æ¨¡å‹...
ğŸ® åˆå§‹åŒ–GPU 2 æ¨¡å‹...
ğŸ® åˆå§‹åŒ–GPU 3 æ¨¡å‹...
âœ… GPU 0 æ¨¡å‹åˆå§‹åŒ–å®Œæˆ
âœ… GPU 1 æ¨¡å‹åˆå§‹åŒ–å®Œæˆ
âœ… GPU 2 æ¨¡å‹åˆå§‹åŒ–å®Œæˆ
âœ… GPU 3 æ¨¡å‹åˆå§‹åŒ–å®Œæˆ
ğŸ”„ å¼€å§‹é¢„å¤„ç†æ¨¡æ¿...
ğŸ”„ é¢„å¤„ç†æ¨¡æ¿: Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7
ğŸ” æå–é¢éƒ¨åæ ‡: Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7
ğŸ§  é¢„è®¡ç®—VAEç¼–ç : Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7
ğŸ­ é¢„è®¡ç®—é¢éƒ¨è§£æ: Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7
âœ… æ¨¡æ¿ Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7 é¢„å¤„ç†å®Œæˆ
ğŸ‰ æ‰€æœ‰æ¨¡æ¿é¢„å¤„ç†å®Œæˆï¼Œå…± 6 ä¸ªæ¨¡æ¿
âœ… Pythonæ¨ç†å™¨åˆå§‹åŒ–å®Œæˆ - æ‰€æœ‰æ¨¡æ¿å·²é¢„å¤„ç†
```

### âš¡ å®é™…æ¨ç†

```
ğŸš€ å¼€å§‹æè‡´ä¼˜åŒ–æ¨ç†: TemplateId=Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7, TotalRequests=1
ğŸš€ å¼€å§‹å¹¶è¡Œæ¨ç†: æ¨¡æ¿=Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7, éŸ³é¢‘=audio.wav
ğŸµ æå–éŸ³é¢‘ç‰¹å¾...
âœ… éŸ³é¢‘ç‰¹å¾æå–å®Œæˆ: 0.85s, å…± 75 å¸§
ğŸ® å¼€å§‹4GPUå¹¶è¡Œæ¨ç†...
ğŸ® GPU 0 å·¥ä½œçº¿ç¨‹å¯åŠ¨
ğŸ® GPU 1 å·¥ä½œçº¿ç¨‹å¯åŠ¨
ğŸ® GPU 2 å·¥ä½œçº¿ç¨‹å¯åŠ¨
ğŸ® GPU 3 å·¥ä½œçº¿ç¨‹å¯åŠ¨
âœ… 4GPUå¹¶è¡Œæ¨ç†å®Œæˆ: 2.34s
ğŸ¬ å¼€å§‹è§†é¢‘åˆæˆ...
ğŸ–¼ï¸ åˆæˆæœ€ç»ˆå¸§...
ğŸ¬ ç”Ÿæˆè§†é¢‘æ–‡ä»¶...
ğŸ”Š åˆå¹¶éŸ³é¢‘...
âœ… è§†é¢‘ä¿å­˜å®Œæˆ: output.mp4
ğŸ‰ æ¨ç†å®Œæˆ!
ğŸ“Š æ€§èƒ½ç»Ÿè®¡:
   éŸ³é¢‘å¤„ç†: 0.85s
   GPUæ¨ç†: 2.34s
   åå¤„ç†: 1.12s
   æ€»è€—æ—¶: 4.31s
   è§†é¢‘é•¿åº¦: 3.0s
   å®æ—¶ç‡: 0.70x
âœ… æè‡´ä¼˜åŒ–æ¨ç†å®Œæˆ: TemplateId=Template_20250730_14_b2cbd859fb654911a9e14c50f025ecb7, è€—æ—¶=4310ms, å®Œæˆç‡=100.00%
```

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

è¾¾åˆ°å½“å‰è®¾å¤‡æè‡´æ€§èƒ½åï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **é›†æˆMuseV**: ç”Ÿæˆæ›´ä¸°å¯Œçš„è¡¨æƒ…å’ŒåŠ¨ä½œ
2. **æµå¼å¤„ç†**: æ”¯æŒé•¿éŸ³é¢‘çš„åˆ†æ®µå¹¶è¡Œå¤„ç†
3. **æ¨¡å‹é‡åŒ–**: è¿›ä¸€æ­¥å‡å°‘æ˜¾å­˜å ç”¨
4. **ç¼“å­˜ä¼˜åŒ–**: æ™ºèƒ½é¢„æµ‹å’Œé¢„åŠ è½½çƒ­é—¨æ¨¡æ¿

è¿™ä¸ªæ–¹æ¡ˆä¸“é—¨é’ˆå¯¹æ‚¨çš„å›ºå®šæ¨¡æ¿éœ€æ±‚ï¼Œå»é™¤äº†æ‰€æœ‰ä¸å¿…è¦çš„å¤æ‚æ€§ï¼Œä¸“æ³¨äºåœ¨4x RTX 4090ä¸Šè¾¾åˆ°æè‡´æ€§èƒ½ï¼ğŸ¯âœ¨