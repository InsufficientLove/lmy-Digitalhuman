@echo off
chcp 65001 >nul
echo ================================================================================
echo              ðŸ¦™ ä½¿ç”¨Ollamaç®¡ç†Qwen2.5-14Bæ¨¡åž‹
echo ================================================================================
echo.
echo [ðŸ’¡] ä¸ºä»€ä¹ˆä½¿ç”¨Ollamaè€Œä¸æ˜¯ç›´æŽ¥ä¸‹è½½?
echo   âœ… è‡ªåŠ¨ç®¡ç†æ¨¡åž‹ä¸‹è½½å’Œå­˜å‚¨
echo   âœ… ä¼˜åŒ–çš„æŽ¨ç†å¼•æ“Žï¼Œé€Ÿåº¦æ›´å¿«
echo   âœ… æ”¯æŒé‡åŒ–æ¨¡åž‹ï¼ŒèŠ‚çœæ˜¾å­˜
echo   âœ… æ— éœ€æ‰‹åŠ¨ç®¡ç†28GBçš„åŽŸå§‹æ–‡ä»¶
echo   âœ… è‡ªåŠ¨å¤„ç†Git LFSé—®é¢˜
echo.
pause

echo ================================================================================
echo [æ­¥éª¤ 1/4] æ£€æŸ¥Ollamaå®‰è£…
echo ================================================================================

ollama --version >nul 2>&1
if %errorlevel% neq 0 (
    echo [âŒ] Ollamaæœªå®‰è£…ï¼Œæ­£åœ¨ä¸‹è½½å®‰è£…...
    echo [ðŸ“¥] ä¸‹è½½Ollamaå®‰è£…åŒ…...
    
    powershell -Command "Invoke-WebRequest -Uri 'https://ollama.com/download/windows' -OutFile 'ollama-windows-amd64.exe'"
    
    if exist "ollama-windows-amd64.exe" (
        echo [ðŸš€] è¯·æ‰‹åŠ¨è¿è¡Œ ollama-windows-amd64.exe å®‰è£…Ollama
        echo [â¸ï¸] å®‰è£…å®ŒæˆåŽæŒ‰ä»»æ„é”®ç»§ç»­...
        pause
    ) else (
        echo [âŒ] ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è®¿é—® https://ollama.com/download ä¸‹è½½
        pause
        exit /b 1
    )
) else (
    echo [âœ…] Ollamaå·²å®‰è£…
    ollama --version
)

echo.
echo ================================================================================
echo [æ­¥éª¤ 2/4] å¯åŠ¨OllamaæœåŠ¡
echo ================================================================================

echo [ðŸš€] å¯åŠ¨OllamaæœåŠ¡...
start /b ollama serve

echo [â³] ç­‰å¾…æœåŠ¡å¯åŠ¨...
timeout /t 5 /nobreak >nul

echo [ðŸ”] æ£€æŸ¥æœåŠ¡çŠ¶æ€...
curl -s http://localhost:11434/api/tags >nul 2>&1
if %errorlevel% equ 0 (
    echo [âœ…] OllamaæœåŠ¡è¿è¡Œæ­£å¸¸
) else (
    echo [âš ï¸] æœåŠ¡å¯èƒ½è¿˜åœ¨å¯åŠ¨ä¸­ï¼Œç»§ç»­æ‰§è¡Œ...
)

echo.
echo ================================================================================
echo [æ­¥éª¤ 3/4] ä¸‹è½½Qwen2.5æ¨¡åž‹
echo ================================================================================

echo [ðŸ“‹] å¯ç”¨çš„Qwen2.5æ¨¡åž‹ç‰ˆæœ¬:
echo   1. qwen2.5:7b         - 7Bå‚æ•°ï¼Œé€Ÿåº¦å¿« (~4GB)
echo   2. qwen2.5:14b        - 14Bå‚æ•°ï¼Œå¹³è¡¡æ€§èƒ½ (~8GB) 
echo   3. qwen2.5:32b        - 32Bå‚æ•°ï¼Œæœ€ä½³æ•ˆæžœ (~20GB)
echo   4. qwen2.5:14b-instruct-q4_0 - 14Bé‡åŒ–ç‰ˆæœ¬ (~8GBï¼ŒæŽ¨è)
echo.

set /p model_choice="è¯·é€‰æ‹©æ¨¡åž‹ (1-4, é»˜è®¤4): "

if "%model_choice%"=="" set model_choice=4
if "%model_choice%"=="1" (
    set model_name=qwen2.5:7b
    set model_desc=7Bå‚æ•°ç‰ˆæœ¬
) else if "%model_choice%"=="2" (
    set model_name=qwen2.5:14b
    set model_desc=14Bå‚æ•°ç‰ˆæœ¬
) else if "%model_choice%"=="3" (
    set model_name=qwen2.5:32b
    set model_desc=32Bå‚æ•°ç‰ˆæœ¬
) else (
    set model_name=qwen2.5:14b-instruct-q4_0
    set model_desc=14Bé‡åŒ–ç‰ˆæœ¬
)

echo.
echo [ðŸ“¥] å¼€å§‹ä¸‹è½½ %model_name% (%model_desc%)...
echo [â±ï¸] è¿™å¯èƒ½éœ€è¦10-30åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…...
echo.

ollama pull %model_name%

if %errorlevel% equ 0 (
    echo [ðŸŽ‰] æ¨¡åž‹ä¸‹è½½æˆåŠŸï¼
) else (
    echo [âŒ] æ¨¡åž‹ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
    pause
    exit /b 1
)

echo.
echo ================================================================================
echo [æ­¥éª¤ 4/4] éªŒè¯å’Œé…ç½®
echo ================================================================================

echo [ðŸ”] éªŒè¯æ¨¡åž‹å®‰è£…...
ollama list

echo.
echo [ðŸ§ª] æµ‹è¯•æ¨¡åž‹æŽ¨ç†...
echo [ðŸ’­] æµ‹è¯•é—®é¢˜: "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"
echo.

ollama run %model_name% "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"

echo.
echo [ðŸ”§] æ›´æ–°é¡¹ç›®é…ç½®...

echo [ðŸ“] å½“å‰é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡åž‹åç§°: %model_name%
echo [ðŸ’¡] å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ç¼–è¾‘ appsettings.json ä¸­çš„ Ollama.Model é…ç½®

echo.
echo ================================================================================
echo                           è®¾ç½®å®Œæˆ
echo ================================================================================

echo [ðŸŽ‰] Ollama + Qwen2.5 è®¾ç½®æˆåŠŸï¼
echo.
echo [ðŸ“Š] ä¼˜åŠ¿æ€»ç»“:
echo   âœ… æ— éœ€æ‰‹åŠ¨ä¸‹è½½28GBåŽŸå§‹æ–‡ä»¶
echo   âœ… è‡ªåŠ¨ä¼˜åŒ–æŽ¨ç†æ€§èƒ½
echo   âœ… æ”¯æŒæµå¼å“åº”
echo   âœ… æ˜¾å­˜å ç”¨æ›´å°‘
echo   âœ… å¯åŠ¨é€Ÿåº¦æ›´å¿«
echo.
echo [ðŸš€] ä¸‹ä¸€æ­¥:
echo   1. æ¨¡åž‹å·²å¯ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®
echo   2. ç»§ç»­ä¸‹è½½MuseTalkæ¨¡åž‹
echo   3. è¿è¡Œ deploy-production-now.bat
echo.
echo [ðŸ’¡] å¦‚æžœéœ€è¦åˆ‡æ¢æ¨¡åž‹:
echo   ollama pull å…¶ä»–æ¨¡åž‹åç§°
echo   ç„¶åŽä¿®æ”¹ appsettings.json ä¸­çš„é…ç½®
echo.

echo æŒ‰ä»»æ„é”®é€€å‡º...
pause >nul