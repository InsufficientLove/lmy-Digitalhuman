@echo off
chcp 65001 > nul
color 0B
title 数字人系统 - 开发证书信任工具

echo ================================================================================
echo                          数字人系统 - 开发证书信任工具
echo ================================================================================
echo.
echo 此工具将帮助您解决 HTTPS 开发环境的证书信任问题
echo.
echo 🔧 即将执行的操作：
echo   1. 清理现有的开发证书
echo   2. 生成新的受信任开发证书
echo   3. 解决 ERR_HTTP2_INADEQUATE_TRANSPORT_SECURITY 错误
echo.
pause

echo ================================================================================
echo [步骤 1/2] 清理现有开发证书
echo ================================================================================

echo [信息] 正在清理现有证书...
dotnet dev-certs https --clean
if %errorlevel% neq 0 (
    echo [警告] 清理证书时遇到问题，继续执行...
)

echo ================================================================================
echo [步骤 2/2] 生成并信任新证书
echo ================================================================================

echo [信息] 正在生成新的开发证书...
dotnet dev-certs https --trust
if %errorlevel% neq 0 (
    echo [错误] 证书生成失败
    echo.
    echo 请尝试以管理员身份运行此脚本
    pause
    goto end
) else (
    echo [✓] 开发证书生成并信任成功
)

echo ================================================================================
echo                                证书配置完成
echo ================================================================================
echo.
echo [✓] 开发证书配置成功！
echo.
echo 🚀 现在您可以：
echo.
echo   1. 重新启动 Visual Studio 2022
echo   2. 重新运行项目
echo   3. 访问 https://localhost:7001/digital-human-test.html
echo.
echo 💡 如果仍有问题，请尝试：
echo   - 重启浏览器
echo   - 清除浏览器缓存
echo   - 使用无痕/隐私模式
echo.

:end
echo 按任意键退出...
pause >nul